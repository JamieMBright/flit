name: Deploy Vercel (Scheduled)

on:
  schedule:
    # Run daily at 01:00 UTC for Vercel deploy hook
    - cron: '0 1 * * *'
  workflow_dispatch:

jobs:
  deploy-vercel:
    name: Deploy Vercel (Error Telemetry)
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Vercel production deployment
        env:
          VERCEL_DEPLOY_HOOK: ${{ secrets.VERCEL_DEPLOY_HOOK }}
        run: |
          if [ -z "$VERCEL_DEPLOY_HOOK" ]; then
            echo "::warning::VERCEL_DEPLOY_HOOK secret not set â€” skipping Vercel deploy"
            exit 0
          fi

          echo "Triggering Vercel production deployment..."
          HTTP_STATUS=$(curl -sf -o /dev/null -w "%{http_code}" -X POST "$VERCEL_DEPLOY_HOOK")

          if [ "$HTTP_STATUS" -eq 200 ] || [ "$HTTP_STATUS" -eq 201 ]; then
            echo "Vercel deployment triggered successfully (HTTP ${HTTP_STATUS})"
          else
            echo "::warning::Vercel deploy hook returned HTTP ${HTTP_STATUS}"
          fi
