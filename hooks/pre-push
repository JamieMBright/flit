#!/bin/bash
# Pre-push hook: Full validation before push
# Runs: format, analyze, all tests, web build, android build

set -e

echo "ğŸš€ Running pre-push validation..."

# Check if Flutter is available
if ! command -v flutter &> /dev/null; then
    echo "âš ï¸  Flutter not found locally - skipping local checks"
    echo "   CI will run full validation on push"
    exit 0
fi

echo ""
echo "ğŸ“ Step 1/6: Checking format..."
dart format --set-exit-if-changed lib/ test/

echo ""
echo "ğŸ” Step 2/6: Running analyzer..."
flutter analyze --fatal-warnings

echo ""
echo "ğŸ§ª Step 3/6: Running unit tests with coverage..."
flutter test --coverage

echo ""
echo "ğŸŒ Step 4/6: Building web..."
flutter build web --release

echo ""
echo "ğŸ¤– Step 5/6: Building Android..."
flutter build apk --release

echo ""
echo "ğŸ”’ Step 6/6: Security audit..."
# Check for known vulnerable packages
flutter pub outdated --dependency-overrides

echo ""
echo "âœ… All pre-push checks passed!"
echo "   Safe to push to remote."
